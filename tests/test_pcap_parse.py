#!/usr/bin/env python3

# run only one test:
# python -m unittest test_netfoot.Netfoot_log_unittest.test_infos_lookup

import sys
import unittest
from pathlib import Path

sys.path.append(str(Path(__file__).resolve().parent.parent / 'lib'))
from pcap_parse import Pcap_parse

INPUT_DATA_DIRECTORY = Path(__file__).resolve().parent.parent / 'demo_data'

EXPECTED_RESULTS = {
    'network2_with_pcap/host_192.168.3.131_pcap_enp0s31f6.pcap': {
        ('192.168.3.131', 57011, '72.14.213.138', 80, 'TCP'): {'packets': 9, 'bytes': 4533}, ('192.168.3.131', 55950, '72.14.213.102', 80, 'TCP'): {'packets': 9, 'bytes': 1815}, ('192.168.3.131', 52152, '72.14.213.147', 443, 'TCP'): {'packets': 82, 'bytes': 34986}, ('192.168.3.131', 55953, '65.55.206.209', 80, 'TCP'): {'packets': 6, 'bytes': 1013}, ('192.168.3.131', 55954, '65.55.17.37', 80, 'TCP'): {'packets': 32, 'bytes': 27603}, ('192.168.3.131', 55955, '207.46.148.38', 80, 'TCP'): {'packets': 8, 'bytes': 1067}, ('192.168.3.131', 55956, '66.235.139.121', 80, 'TCP'): {'packets': 13, 'bytes': 5867}, ('192.168.3.131', 55957, '65.55.5.232', 80, 'TCP'): {'packets': 21, 'bytes': 13043}, ('192.168.3.131', 55958, '65.55.239.163', 80, 'TCP'): {'packets': 12, 'bytes': 4073}, ('192.168.3.131', 55959, '65.55.5.231', 80, 'TCP'): {'packets': 18, 'bytes': 10089}, ('192.168.3.131', 55960, '206.108.207.139', 80, 'TCP'): {'packets': 16, 'bytes': 4228}, ('192.168.3.131', 55961, '184.24.133.32', 80, 'TCP'): {'packets': 7, 'bytes': 1530}, ('192.168.3.131', 55962, '65.55.5.232', 80, 'TCP'): {'packets': 12, 'bytes': 6905}, ('192.168.3.131', 55963, '65.54.95.140', 80, 'TCP'): {'packets': 25, 'bytes': 14796}, ('192.168.3.131', 55966, '63.215.202.48', 80, 'TCP'): {'packets': 6, 'bytes': 1395}, ('192.168.3.131', 55967, '63.215.202.49', 80, 'TCP'): {'packets': 8, 'bytes': 5178}, ('192.168.3.131', 55968, '72.14.213.101', 80, 'TCP'): {'packets': 11, 'bytes': 2728}, ('192.168.3.131', 55971, '65.55.17.37', 80, 'TCP'): {'packets': 8, 'bytes': 2832}, ('192.168.3.131', 57839, '72.14.213.147', 80, 'TCP'): {'packets': 40, 'bytes': 28761}, ('192.168.3.131', 55972, '207.46.216.54', 80, 'TCP'): {'packets': 12, 'bytes': 2838}, ('192.168.3.131', 55973, '65.54.95.142', 80, 'TCP'): {'packets': 42, 'bytes': 35296}, ('192.168.3.131', 58264, '208.82.236.129', 80, 'TCP'): {'packets': 9, 'bytes': 1153}, ('192.168.3.131', 58265, '208.82.236.129', 80, 'TCP'): {'packets': 14, 'bytes': 7838}, ('72.14.213.105', 443, '192.168.3.131', 57721, 'TCP'): {'packets': 6, 'bytes': 338}, ('192.168.3.131', 58272, '208.82.236.129', 80, 'TCP'): {'packets': 15, 'bytes': 7772}, ('72.14.213.18', 443, '192.168.3.131', 49673, 'TCP'): {'packets': 30, 'bytes': 3112}, ('192.168.3.131', 57757, '239.255.255.250', 1900, 'UDP'): {'packets': 6, 'bytes': 912}, ('192.168.3.131', 57038, '74.217.50.10', 80, 'TCP'): {'packets': 3, 'bytes': 120}, ('192.168.3.131', 52201, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 2689}, ('192.168.3.131', 52202, '72.14.213.102', 443, 'TCP'): {'packets': 125, 'bytes': 75078}, ('192.168.3.131', 52203, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 2689}, ('192.168.3.131', 52204, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 2689}, ('192.168.3.131', 52205, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 2689}, ('192.168.3.131', 52206, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 2689}, ('192.168.3.131', 52207, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 2689}, ('192.168.3.131', 52208, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 52209, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 52210, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 52211, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 52212, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 52213, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 52214, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 52215, '72.14.213.102', 443, 'TCP'): {'packets': 11, 'bytes': 1139}, ('192.168.3.131', 58303, '208.82.236.129', 80, 'TCP'): {'packets': 9, 'bytes': 1154}, ('192.168.3.131', 58304, '208.82.236.129', 80, 'TCP'): {'packets': 14, 'bytes': 7914}, ('192.168.3.131', 58305, '208.82.236.129', 80, 'TCP'): {'packets': 10, 'bytes': 2281}, ('192.168.3.131', 56012, '65.54.95.140', 80, 'TCP'): {'packets': 48, 'bytes': 41666}, ('192.168.3.131', 58310, '208.82.236.129', 80, 'TCP'): {'packets': 16, 'bytes': 9661}, ('192.168.3.131', 56021, '66.235.139.121', 80, 'TCP'): {'packets': 15, 'bytes': 4482}, ('192.168.3.131', 56022, '65.55.206.199', 80, 'TCP'): {'packets': 82, 'bytes': 79652}, ('192.168.3.131', 56023, '184.24.143.139', 80, 'TCP'): {'packets': 7, 'bytes': 1064}, ('192.168.3.131', 56026, '65.54.95.140', 80, 'TCP'): {'packets': 17, 'bytes': 8751}, ('192.168.3.131', 56027, '65.54.95.140', 80, 'TCP'): {'packets': 20, 'bytes': 9589}, ('192.168.3.131', 56028, '65.54.95.142', 80, 'TCP'): {'packets': 14, 'bytes': 6298}, ('192.168.3.131', 56029, '65.54.95.142', 80, 'TCP'): {'packets': 18, 'bytes': 8856}, ('192.168.3.131', 56030, '65.54.95.140', 80, 'TCP'): {'packets': 10, 'bytes': 2033}, ('192.168.3.131', 56031, '65.54.95.140', 80, 'TCP'): {'packets': 10, 'bytes': 2479}, ('192.168.3.131', 56032, '65.54.95.140', 80, 'TCP'): {'packets': 10, 'bytes': 1969}, ('192.168.3.131', 56033, '65.54.95.140', 80, 'TCP'): {'packets': 10, 'bytes': 1976}, ('192.168.3.131', 56034, '65.55.206.199', 80, 'TCP'): {'packets': 20, 'bytes': 14270}, ('192.168.3.131', 56035, '65.55.118.107', 80, 'TCP'): {'packets': 10, 'bytes': 2668}, ('192.168.3.131', 56036, '65.54.95.140', 80, 'TCP'): {'packets': 60, 'bytes': 49689}, ('192.168.3.131', 56037, '65.54.95.140', 80, 'TCP'): {'packets': 54, 'bytes': 44883}, ('192.168.3.131', 56038, '65.54.95.140', 80, 'TCP'): {'packets': 28, 'bytes': 17164}, ('192.168.3.131', 56039, '65.54.95.140', 80, 'TCP'): {'packets': 32, 'bytes': 21361}, ('192.168.3.131', 56040, '65.54.95.140', 80, 'TCP'): {'packets': 29, 'bytes': 19284}, ('192.168.3.131', 56041, '65.54.95.140', 80, 'TCP'): {'packets': 37, 'bytes': 26504}, ('192.168.3.131', 56042, '207.46.148.38', 80, 'TCP'): {'packets': 8, 'bytes': 1551}, ('192.168.3.131', 56044, '65.54.95.216', 80, 'TCP'): {'packets': 30, 'bytes': 19867}, ('192.168.3.131', 56048, '66.220.149.32', 80, 'TCP'): {'packets': 24, 'bytes': 13613}, ('192.168.3.131', 56049, '206.108.207.163', 80, 'TCP'): {'packets': 8, 'bytes': 2635}, ('192.168.3.131', 56050, '66.235.139.121', 80, 'TCP'): {'packets': 4, 'bytes': 184}, ('192.168.3.131', 56051, '207.46.0.109', 80, 'TCP'): {'packets': 31, 'bytes': 19668}, ('192.168.3.131', 56052, '207.46.148.38', 80, 'TCP'): {'packets': 9, 'bytes': 2884}, ('192.168.3.131', 56053, '66.235.133.62', 80, 'TCP'): {'packets': 11, 'bytes': 3176}, ('192.168.3.131', 56054, '206.108.207.145', 80, 'TCP'): {'packets': 13, 'bytes': 3271}, ('192.168.3.131', 56055, '65.54.95.39', 80, 'TCP'): {'packets': 30, 'bytes': 14000}, ('192.168.3.131', 56056, '65.54.95.39', 80, 'TCP'): {'packets': 22, 'bytes': 7309}, ('192.168.3.131', 56057, '65.54.95.66', 80, 'TCP'): {'packets': 19, 'bytes': 8552}, ('192.168.3.131', 56058, '206.108.207.138', 80, 'TCP'): {'packets': 89, 'bytes': 88512}, ('192.168.3.131', 56059, '65.54.95.39', 80, 'TCP'): {'packets': 25, 'bytes': 9843}, ('192.168.3.131', 56060, '65.54.95.39', 80, 'TCP'): {'packets': 14, 'bytes': 8028}, ('192.168.3.131', 56061, '195.27.155.11', 80, 'TCP'): {'packets': 10, 'bytes': 2727}, ('192.168.3.131', 56064, '65.54.95.75', 80, 'TCP'): {'packets': 169, 'bytes': 167103}, ('192.168.3.131', 56065, '65.54.95.68', 80, 'TCP'): {'packets': 177, 'bytes': 181009}, ('192.168.3.131', 56066, '65.54.95.75', 80, 'TCP'): {'packets': 31, 'bytes': 23135}, ('192.168.3.131', 56067, '65.54.95.75', 80, 'TCP'): {'packets': 88, 'bytes': 71168}, ('192.168.3.131', 56068, '65.54.95.68', 80, 'TCP'): {'packets': 42, 'bytes': 30340}, ('192.168.3.131', 56069, '65.54.95.75', 80, 'TCP'): {'packets': 38, 'bytes': 28906}, ('192.168.3.131', 56070, '65.54.95.68', 80, 'TCP'): {'packets': 44, 'bytes': 37208}, ('192.168.3.131', 68, '255.255.255.255', 67, 'UDP'): {'packets': 1, 'bytes': 328}, ('192.168.3.131', 54600, '224.0.0.252', 5355, 'UDP'): {'packets': 2, 'bytes': 100}, ('192.168.3.131', 56073, '65.54.95.75', 80, 'TCP'): {'packets': 49, 'bytes': 35665}, ('192.168.3.131', 58327, '208.82.236.129', 80, 'TCP'): {'packets': 15, 'bytes': 7222}, ('192.168.3.131', 52248, '65.54.95.39', 80, 'TCP'): {'packets': 11, 'bytes': 935}, ('192.168.3.131', 56090, '65.54.95.75', 80, 'TCP'): {'packets': 15, 'bytes': 4666}, ('192.168.3.131', 56091, '65.54.95.75', 80, 'TCP'): {'packets': 16, 'bytes': 6819}, ('192.168.3.131', 56092, '65.54.95.68', 80, 'TCP'): {'packets': 15, 'bytes': 6262}, ('192.168.3.131', 56093, '65.54.95.68', 80, 'TCP'): {'packets': 37, 'bytes': 29682}, ('192.168.3.131', 52257, '65.54.95.39', 80, 'TCP'): {'packets': 11, 'bytes': 901}, ('192.168.3.131', 58350, '208.82.236.129', 80, 'TCP'): {'packets': 10, 'bytes': 3419}, ('192.168.3.131', 58351, '208.82.236.130', 80, 'TCP'): {'packets': 17, 'bytes': 10313}, ('192.168.3.131', 58352, '208.82.236.130', 80, 'TCP'): {'packets': 14, 'bytes': 6945}, ('192.168.3.131', 58353, '208.82.236.130', 80, 'TCP'): {'packets': 17, 'bytes': 10863}, ('192.168.3.131', 52266, '65.54.95.39', 80, 'TCP'): {'packets': 11, 'bytes': 935}, ('192.168.3.131', 58360, '208.82.236.129', 80, 'TCP'): {'packets': 10, 'bytes': 3469}, ('192.168.3.131', 58361, '208.82.236.130', 80, 'TCP'): {'packets': 16, 'bytes': 9929}, ('192.168.3.131', 58362, '208.82.238.129', 80, 'TCP'): {'packets': 3, 'bytes': 144}, ('192.168.3.131', 56110, '65.54.95.68', 80, 'TCP'): {'packets': 42, 'bytes': 36214}, ('192.168.3.131', 56111, '65.54.95.75', 80, 'TCP'): {'packets': 12, 'bytes': 4978}, ('192.168.3.131', 56112, '65.54.95.68', 80, 'TCP'): {'packets': 13, 'bytes': 6490}, ('192.168.3.131', 56113, '65.54.95.75', 80, 'TCP'): {'packets': 13, 'bytes': 6673}, ('192.168.3.131', 58377, '208.82.236.130', 80, 'TCP'): {'packets': 15, 'bytes': 9395}, ('192.168.3.131', 58378, '208.82.236.130', 80, 'TCP'): {'packets': 16, 'bytes': 9855}, ('192.168.3.131', 56126, '66.235.139.121', 80, 'TCP'): {'packets': 11, 'bytes': 2500}, ('192.168.3.131', 58381, '204.9.163.166', 80, 'TCP'): {'packets': 7, 'bytes': 821}, ('192.168.3.131', 56127, '65.54.95.140', 80, 'TCP'): {'packets': 7, 'bytes': 2666}, ('192.168.3.131', 56128, '65.54.95.140', 80, 'TCP'): {'packets': 11, 'bytes': 6586}, ('192.168.3.131', 56129, '207.46.148.38', 80, 'TCP'): {'packets': 9, 'bytes': 3439}, ('192.168.3.131', 56132, '65.54.95.140', 80, 'TCP'): {'packets': 42, 'bytes': 39799}, ('192.168.3.131', 56133, '65.54.95.216', 80, 'TCP'): {'packets': 47, 'bytes': 43066}, ('192.168.3.131', 56134, '66.235.133.62', 80, 'TCP'): {'packets': 6, 'bytes': 1003}, ('192.168.3.131', 56135, '207.46.148.38', 80, 'TCP'): {'packets': 9, 'bytes': 2891}, ('192.168.3.131', 56136, '206.108.207.163', 80, 'TCP'): {'packets': 3, 'bytes': 144}, ('192.168.3.131', 56139, '65.54.95.75', 80, 'TCP'): {'packets': 129, 'bytes': 130085}, ('192.168.3.131', 56140, '65.54.95.68', 80, 'TCP'): {'packets': 63, 'bytes': 59871},
    }
}

class Pcap_parse_unittest(unittest.TestCase):
    def test_network2_with_pcap(self):
        pcapfile = "network2_with_pcap/host_192.168.3.131_pcap_enp0s31f6.pcap"
        parsed = Pcap_parse.parse(INPUT_DATA_DIRECTORY / pcapfile)
        self.assertEqual(EXPECTED_RESULTS[pcapfile], parsed)

if __name__ == "__main__":
    unittest.main()
